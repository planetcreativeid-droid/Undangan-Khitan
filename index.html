<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Undangan Khitanan - Muhammad Kenzie Alfaro</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Great+Vibes&display=swap" rel="stylesheet">

    <!-- Animate On Scroll (AOS) Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0c1a1a;
            color: #E0E0E0;
            overflow-x: hidden;
        }
        .font-cursive {
            font-family: 'Great Vibes', cursive;
        }
        .text-gold {
            color: #c2a167;
        }
        .bg-dark-teal {
            background-color: #0c1a1a;
        }
        .bg-card {
             background-color: #1a3a3a;
        }
        .btn-gold {
            background-color: #c2a167;
            color: #1a3a3a;
            transition: all 0.3s ease;
        }
        .btn-gold:hover {
            background-color: #ad8a4f;
            box-shadow: 0 4px 15px rgba(194, 161, 103, 0.2);
        }
        
        /* --- Ornament Animation (Waterfall Effect) --- */
        .ornament {
            position: absolute;
            width: 250px; /* Adjusted for landscape image */
            height: auto;
            z-index: 1;
            opacity: 0;
            transition: transform 1.2s cubic-bezier(0.19, 1, 0.22, 1), opacity 1s ease-out;
            transition-delay: 0.5s; /* Delay animation start */
        }
        @media (min-width: 768px) {
            .ornament {
                width: 350px; /* Adjusted for landscape image */
            }
        }
        /* Initial positions (top ones are above, bottom ones below) */
        .ornament-tl { top: -20px; left: -20px; transform: translateY(-100%) rotate(0); }
        .ornament-tr { top: -20px; right: -20px; transform: translateY(-100%) scaleX(-1) rotate(0); } /* Flipped horizontally */
        .ornament-bl { bottom: -20px; left: -20px; transform: translateY(100%) scaleY(-1) rotate(0); } /* Flipped vertically */
        .ornament-br { bottom: -20px; right: -20px; transform: translateY(100%) scale(-1, -1) rotate(0); } /* Flipped both */

        /* Final positions (triggered by adding .ornaments-visible class) */
        .ornaments-visible .ornament {
            opacity: 1;
            transform: translateY(0);
        }
        .ornaments-visible .ornament-tl { transform: translate(0, 0) rotate(0); }
        .ornaments-visible .ornament-tr { transform: translate(0, 0) scaleX(-1) rotate(0); }
        .ornaments-visible .ornament-bl { transform: translate(0, 0) scaleY(-1) rotate(0); }
        .ornaments-visible .ornament-br { transform: translate(0, 0) scale(-1, -1) rotate(0); }


        /* Animation for cover opening */
        .cover-open {
            transform: translateY(-100%);
            transition: transform 1.2s cubic-bezier(0.86, 0, 0.07, 1);
        }
        
        /* Music button animation */
        .spin-slow {
            animation: spin 8s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-black">

    <!-- Mobile View Container -->
    <div class="relative max-w-md mx-auto bg-dark-teal shadow-2xl min-h-screen overflow-hidden">

        <!-- Background Music -->
        <audio id="background-music" loop>
            <!-- Ganti source audio di bawah ini dengan link file musik Anda -->
            <source src="https://firebasestorage.googleapis.com/v0/b/canvas-testing-389101.appspot.com/o/1709871295321-hymne-ui.mp3?alt=media&token=c061266b-4aed-4a25-8378-0d9229fb443f" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>

        <!-- Music Player Controls -->
        <div id="music-player" class="hidden absolute bottom-5 right-5 z-50">
            <button id="music-toggle" class="w-12 h-12 bg-gold/80 text-dark-teal rounded-full flex items-center justify-center shadow-lg backdrop-blur-sm">
                <i class="fas fa-music spin-slow"></i>
            </button>
        </div>

        <!-- Cover Section -->
        <div id="cover" class="absolute top-0 left-0 w-full h-full bg-dark-teal z-[100] flex flex-col justify-center items-center text-center p-6" style="background-image: url('https://images.unsplash.com/photo-1599667931367-e6822b322feb?q=80&w=1974&auto=format&fit=crop'); background-size: cover; background-position: center;">
            <div class="absolute inset-0 bg-black/60"></div>
            <div class="relative z-10 text-white" data-aos="fade-up">
                <p class="text-lg">The Khitanan of</p>
                <h1 class="font-cursive text-6xl md:text-8xl my-4 text-gold">Kenzie</h1>
                <p class="mb-6">Kepada Yth. Bapak/Ibu/Saudara/i</p>
                <p id="guest-name" class="text-2xl font-bold mb-8"></p>
                <button id="open-invitation" class="btn-gold font-bold py-3 px-8 rounded-full shadow-lg">
                    <i class="fas fa-envelope-open mr-2"></i>
                    Buka Undangan
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <main id="main-content" class="opacity-0 transition-opacity duration-1000">
            
            <!-- Hero Section -->
            <section id="hero" class="relative min-h-screen flex flex-col items-center justify-center text-center p-6 overflow-hidden" style="background-image: url('https://images.unsplash.com/photo-1618215935338-9b2c89284353?q=80&w=1974&auto=format&fit=crop'); background-size: cover; background-position: center;">
                <div class="absolute inset-0 bg-black/70"></div>
                <!-- Ornaments with new landscape image -->
                <img src="https://i.ibb.co/dKqY7Jd/ornament-landscape.png" alt="Ornament" class="ornament ornament-tl">
                <img src="https://i.ibb.co/dKqY7Jd/ornament-landscape.png" alt="Ornament" class="ornament ornament-tr">
                <img src="https://i.ibb.co/dKqY7Jd/ornament-landscape.png" alt="Ornament" class="ornament ornament-bl">
                <img src="https://i.ibb.co/dKqY7Jd/ornament-landscape.png" alt="Ornament" class="ornament ornament-br">
                
                <div class="relative z-10">
                    <p class="font-cursive text-3xl text-gold" data-aos="fade-down">Bismillahirrahmannirrahim</p>
                    <h2 class="text-lg md:text-xl tracking-widest my-4" data-aos="fade-up">UNDANGAN KHITANAN</h2>
                    <h1 class="font-cursive text-6xl md:text-8xl text-gold my-4" data-aos="zoom-in">Muhammad Kenzie Alfaro</h1>
                    <p class="text-lg md:text-xl" data-aos="fade-up">Sabtu, 18 November 2025</p>

                    <div id="countdown" class="flex justify-center space-x-4 mt-8 text-white" data-aos="fade-up" data-aos-delay="200">
                        <div class="bg-white/10 p-4 rounded-lg w-20 text-center backdrop-blur-sm">
                            <span id="days" class="text-3xl font-bold">00</span>
                            <p class="text-xs">Hari</p>
                        </div>
                        <div class="bg-white/10 p-4 rounded-lg w-20 text-center backdrop-blur-sm">
                            <span id="hours" class="text-3xl font-bold">00</span>
                            <p class="text-xs">Jam</p>
                        </div>
                        <div class="bg-white/10 p-4 rounded-lg w-20 text-center backdrop-blur-sm">
                            <span id="minutes" class="text-3xl font-bold">00</span>
                            <p class="text-xs">Menit</p>
                        </div>
                        <div class="bg-white/10 p-4 rounded-lg w-20 text-center backdrop-blur-sm">
                            <span id="seconds" class="text-3xl font-bold">00</span>
                            <p class="text-xs">Detik</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Profile Section -->
            <section id="profile" class="py-20 px-6 text-center">
                <div class="max-w-4xl mx-auto">
                    <p class="font-cursive text-4xl text-gold" data-aos="fade-down">Assalamu'alaikum Wr. Wb.</p>
                    <p class="mt-6 max-w-2xl mx-auto" data-aos="fade-up">
                        Dengan memohon rahmat dan ridho Allah SWT, sebagai ungkapan rasa syukur kami atas karunia-Nya, kami bermaksud menyelenggarakan Tasyakuran Khitanan putra kami:
                    </p>
                    <div class="my-12" data-aos="zoom-in">
                        <img src="https://i.ibb.co/gR2Ym4w/anak-placeholder.png" alt="Muhammad Kenzie Alfaro" class="w-48 h-48 md:w-60 md:h-60 rounded-full mx-auto object-cover border-4 border-gold shadow-lg">
                    </div>
                    <h3 class="font-cursive text-6xl text-gold" data-aos="fade-up">Muhammad Kenzie Alfaro</h3>
                    <p class="mt-4 text-lg" data-aos="fade-up" data-aos-delay="100">Putra dari Bpk. Jajang & Ibu. Naning</p>
                    <img src="https://i.ibb.co/Jqj5B9J/ornament-2.png" alt="Ornament" class="mx-auto mt-8 w-64" data-aos="zoom-in" data-aos-delay="200">
                </div>
            </section>

            <!-- Save The Date Section -->
            <section id="date" class="py-20 px-6 bg-card">
                <div class="max-w-4xl mx-auto text-center">
                    <h2 class="font-cursive text-5xl text-gold" data-aos="fade-down">Save The Date</h2>
                    <p class="mt-4 mb-12" data-aos="fade-up">Dengan penuh rasa syukur, kami mengundang Bapak/Ibu/Saudara/i untuk hadir dan memberikan do'a restu pada acara tasyakuran putra kami.</p>
                    <div class="flex flex-col md:flex-row gap-8 justify-center">
                        <!-- Tasyakuran Khitan -->
                        <div class="bg-dark-teal p-8 rounded-2xl shadow-lg flex-1" data-aos="fade-up-right">
                            <h3 class="font-cursive text-4xl text-gold">Tasyakuran Khitan</h3>
                            <p class="mt-4 text-lg font-semibold">Sabtu, 18 November 2025</p>
                            <p class="mt-2"><i class="far fa-clock mr-2"></i>11.00 WIB - Selesai</p>
                            <p class="mt-2"><i class="fas fa-map-marker-alt mr-2"></i>Kediaman Kami</p>
                            <p class="text-sm mt-1">Jl. Mawar No. 1, Desa Suka Maju, Kec. Bahagia, Kab. Sejahtera</p>
                            <a href="https://maps.app.goo.gl/u5nKxZz8qY9JzX7aA" target="_blank" class="inline-block mt-6 btn-gold text-sm font-bold py-2 px-6 rounded-full">
                                <i class="fas fa-map-marked-alt mr-2"></i>Lihat Peta
                            </a>
                        </div>
                    </div>
                    <div class="mt-12" data-aos="fade-up">
                        <a href="https://www.google.com/calendar/render?action=TEMPLATE&text=Tasyakuran+Khitanan+Kenzie&dates=20251118T110000/20251118T170000&details=Tasyakuran+Khitanan+Muhammad+Kenzie+Alfaro&location=Jl.+Mawar+No.+1,+Desa+Suka+Maju,+Kec.+Bahagia,+Kab.+Sejahtera" target="_blank" class="btn-gold font-bold py-3 px-8 rounded-full">
                            <i class="far fa-calendar-alt mr-2"></i>Tambahkan ke Kalender
                        </a>
                    </div>
                </div>
            </section>
            
            <!-- Gallery Section -->
            <section id="gallery" class="py-20 px-6 text-center">
                <div class="max-w-5xl mx-auto">
                    <h2 class="font-cursive text-5xl text-gold" data-aos="fade-down">Momen Bahagia</h2>
                    <p class="mt-4 mb-12" data-aos="fade-up">Beberapa momen kebersamaan ananda Kenzie.</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div data-aos="zoom-in"><img src="https://placehold.co/600x600/1a3a3a/c2a167?text=Kenzie" alt="Gallery 1" class="rounded-lg shadow-lg w-full h-full object-cover"></div>
                        <div data-aos="zoom-in" data-aos-delay="100"><img src="https://placehold.co/600x800/1a3a3a/c2a167?text=Kenzie" alt="Gallery 2" class="rounded-lg shadow-lg w-full h-full object-cover"></div>
                        <div data-aos="zoom-in" data-aos-delay="200"><img src="https://placehold.co/600x600/1a3a3a/c2a167?text=Kenzie" alt="Gallery 3" class="rounded-lg shadow-lg w-full h-full object-cover"></div>
                        <div data-aos="zoom-in" data-aos-delay="300"><img src="https://placehold.co/600x800/1a3a3a/c2a167?text=Kenzie" alt="Gallery 4" class="rounded-lg shadow-lg w-full h-full object-cover"></div>
                        <div data-aos="zoom-in" data-aos-delay="400"><img src="https://placehold.co/600x600/1a3a3a/c2a167?text=Kenzie" alt="Gallery 5" class="rounded-lg shadow-lg w-full h-full object-cover"></div>
                        <div data-aos="zoom-in" data-aos-delay="500"><img src="https://placehold.co/600x800/1a3a3a/c2a167?text=Kenzie" alt="Gallery 6" class="rounded-lg shadow-lg w-full h-full object-cover"></div>
                    </div>
                </div>
            </section>

            <!-- Gift Section -->
            <section id="gift" class="py-20 px-6 bg-card text-center">
                <div class="max-w-4xl mx-auto">
                    <h2 class="font-cursive text-5xl text-gold" data-aos="fade-down">Kirim Hadiah</h2>
                    <p class="mt-4 mb-8" data-aos="fade-up">Doa restu Anda merupakan karunia yang sangat berarti bagi kami. Namun jika memberi adalah ungkapan tanda kasih, Anda dapat memberi kado secara cashless untuk ananda Kenzie.</p>
                    
                    <div class="mt-8 grid md:grid-cols-1 gap-8 text-left">
                        <!-- Amplop Digital -->
                        <div class="bg-dark-teal p-8 rounded-2xl shadow-lg" data-aos="fade-up" data-aos-delay="100">
                            <img src="https://i.ibb.co/L0f5cDm/bca-logo.png" alt="BCA" class="h-8 mb-4">
                            <p>Bank Central Asia</p>
                            <p class="text-2xl font-bold my-2 tracking-widest" id="account-number">1234567890</p>
                            <p>a.n. Jajang (Ayah Kenzie)</p>
                            <button onclick="copyToClipboard('#account-number', 'Nomor rekening disalin!')" class="inline-block mt-6 bg-gray-500 hover:bg-gray-600 text-white text-sm font-bold py-2 px-6 rounded-full">
                                <i class="far fa-copy mr-2"></i>Salin No. Rekening
                            </button>
                        </div>
                        <!-- Kado Fisik -->
                        <div class="bg-dark-teal p-8 rounded-2xl shadow-lg" data-aos="fade-up" data-aos-delay="200">
                            <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-gift mr-3 text-gold"></i>Kirim Kado Fisik</h3>
                            <p class="font-semibold">Penerima:</p>
                            <p>Keluarga Bpk. Jajang</p>
                            <p class="font-semibold mt-2">Alamat:</p>
                            <p id="gift-address">Jl. Mawar No. 1, Desa Suka Maju, Kec. Bahagia, Kab. Sejahtera, 12345</p>
                            <button onclick="copyToClipboard('#gift-address', 'Alamat berhasil disalin!')" class="inline-block mt-6 bg-gray-500 hover:bg-gray-600 text-white text-sm font-bold py-2 px-6 rounded-full">
                                <i class="far fa-copy mr-2"></i>Salin Alamat
                            </button>
                        </div>
                    </div>

                     <div id="copy-feedback" class="mt-6 text-green-400 opacity-0 transition-opacity duration-300"></div>
                </div>
            </section>

            <!-- Wishes Section -->
            <section id="wishes" class="py-20 px-6 text-center">
                <div class="max-w-2xl mx-auto">
                    <h2 class="font-cursive text-5xl text-gold" data-aos="fade-down">Ucapan & Do'a</h2>
                    <p class="mt-4 mb-12" data-aos="fade-up">Berikan ucapan dan do'a terbaik Anda untuk ananda Kenzie.</p>
                    
                    <!-- Form -->
                    <form id="wishes-form" class="bg-card p-8 rounded-2xl shadow-lg text-left" data-aos="fade-up">
                        <div class="mb-4">
                            <label for="name" class="block mb-2">Nama</label>
                            <input type="text" id="name" name="name" class="w-full bg-dark-teal rounded-lg p-3 border border-gray-600 focus:border-gold focus:ring-gold" required>
                        </div>
                        <div class="mb-4">
                            <label for="message" class="block mb-2">Ucapan</label>
                            <textarea id="message" name="message" rows="4" class="w-full bg-dark-teal rounded-lg p-3 border border-gray-600 focus:border-gold focus:ring-gold" required></textarea>
                        </div>
                        <div class="mb-6">
                            <label class="block mb-2">Konfirmasi Kehadiran</label>
                            <div class="flex gap-4">
                                <label class="flex items-center">
                                    <input type="radio" name="attendance" value="Hadir" class="form-radio text-gold focus:ring-gold" checked>
                                    <span class="ml-2">Hadir</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="attendance" value="Tidak Hadir" class="form-radio text-gold focus:ring-gold">
                                    <span class="ml-2">Tidak Hadir</span>
                                </label>
                            </div>
                        </div>
                        <button type="submit" class="btn-gold font-bold py-3 px-8 rounded-full w-full">
                            <i class="fas fa-paper-plane mr-2"></i>Kirim Ucapan
                        </button>
                    </form>

                    <!-- Wishes List -->
                    <div id="wishes-list" class="mt-12 text-left space-y-4">
                        <!-- Wishes will be loaded here by JavaScript -->
                        <div class="text-center p-8">
                            <p>Memuat ucapan...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Footer -->
            <footer class="py-20 px-6 text-center bg-card">
                <div class="max-w-4xl mx-auto" data-aos="fade-up">
                    <p class="max-w-2xl mx-auto">
                        Merupakan suatu kehormatan dan kebahagiaan bagi kami sekeluarga, apabila Bapak/Ibu/Saudara/i berkenan hadir untuk memberikan do'a restu kepada putra kami.
                    </p>
                    <p class="font-cursive text-4xl text-gold mt-8">Wassalamu'alaikum Wr. Wb.</p>
                    <h3 class="font-cursive text-6xl text-gold mt-12">Kenzie</h3>
                    <p class="mt-4 text-lg">Kami yang berbahagia,</p>
                    <p class="mt-1 font-semibold">Keluarga Bpk. Jajang & Ibu. Naning</p>
                    <p class="mt-16 text-xs text-gray-400">&copy; 2025 Dibuat dengan <i class="fas fa-heart text-red-500"></i>. All Rights Reserved.</p>
                </div>
            </footer>

        </main>
    
    </div> <!-- End Mobile View Container -->

    <!-- AOS JS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <!-- Firebase -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config) 
            : { 
                apiKey: "YOUR_API_KEY", 
                authDomain: "YOUR_AUTH_DOMAIN", 
                projectId: "YOUR_PROJECT_ID"
                // Add other necessary config keys
              }; // Fallback config

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        setLogLevel('debug'); // Enable debug logging
        const auth = getAuth(app);

        // --- Firestore Logic ---
        const wishesCollectionPath = `artifacts/${appId}/public/data/wishes`;

        // Function to render wishes
        function renderWishes(wishes) {
            const wishesList = document.getElementById('wishes-list');
            if (!wishesList) return;

            if (wishes.length === 0) {
                wishesList.innerHTML = '<p class="text-center text-gray-400">Belum ada ucapan. Jadilah yang pertama!</p>';
                return;
            }

            wishesList.innerHTML = wishes.map(wish => `
                <div class="bg-card p-4 rounded-lg shadow-md">
                    <div class="flex items-center mb-2">
                        <div class="w-10 h-10 rounded-full bg-gold/20 flex items-center justify-center mr-3">
                            <i class="fas fa-user text-gold"></i>
                        </div>
                        <div>
                            <p class="font-bold">${escapeHTML(wish.name)}</p>
                            <span class="text-xs px-2 py-1 rounded-full ${wish.attendance === 'Hadir' ? 'bg-green-500/20 text-green-300' : 'bg-red-500/20 text-red-300'}">
                                <i class="fa ${wish.attendance === 'Hadir' ? 'fa-check-circle' : 'fa-times-circle'} mr-1"></i>
                                ${escapeHTML(wish.attendance)}
                            </span>
                        </div>
                    </div>
                    <p class="text-gray-300">${escapeHTML(wish.message)}</p>
                </div>
            `).join('');
        }
        
        // Listen for real-time updates
        function listenForWishes() {
             const q = query(collection(db, wishesCollectionPath));
             onSnapshot(q, (querySnapshot) => {
                console.log("Wishes snapshot received:", querySnapshot.size);
                const wishes = [];
                querySnapshot.forEach((doc) => {
                    wishes.push(doc.data());
                });
                // Sort by timestamp if available, otherwise just use order from snapshot
                wishes.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
                renderWishes(wishes);
            }, (error) => {
                console.error("Error fetching wishes: ", error);
                const wishesList = document.getElementById('wishes-list');
                if(wishesList) wishesList.innerHTML = '<p class="text-center text-red-400">Gagal memuat ucapan. Periksa konsol untuk detail.</p>';
            });
        }

        // Handle form submission
        const wishesForm = document.getElementById('wishes-form');
        if (wishesForm) {
            wishesForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const form = e.target;
                const submitButton = form.querySelector('button[type="submit"]');
                const originalButtonText = submitButton.innerHTML;
                
                submitButton.disabled = true;
                submitButton.innerHTML = 'Mengirim...';

                try {
                    await addDoc(collection(db, wishesCollectionPath), {
                        name: form.name.value,
                        message: form.message.value,
                        attendance: form.attendance.value,
                        timestamp: serverTimestamp()
                    });
                    form.reset();
                } catch (error) {
                    console.error("Error adding document: ", error);
                    alert("Gagal mengirim ucapan. Silakan coba lagi.");
                } finally {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                }
            });
        }
        
        // Authenticate and start listening
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // User is signed in.
                console.log("User authenticated, fetching wishes...");
                listenForWishes();
            } else {
                // User is signed out. Sign in anonymously or with custom token.
                try {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch(error) {
                    console.error("Authentication failed:", error);
                }
            }
        });

    </script>
    
    <script>
        // Function to escape HTML to prevent XSS
        function escapeHTML(str) {
            if (!str) return "";
            return str.replace(/[&<>"']/g, function(match) {
                return {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#39;'
                }[match];
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            AOS.init({
                duration: 800,
                once: false, // animation happens every time you scroll
            });

            const cover = document.getElementById('cover');
            const mainContent = document.getElementById('main-content');
            const openButton = document.getElementById('open-invitation');
            const guestNameEl = document.getElementById('guest-name');
            const music = document.getElementById('background-music');
            const musicPlayer = document.getElementById('music-player');
            const musicToggle = document.getElementById('music-toggle');
            const heroSection = document.getElementById('hero');
            
            // 1. Get guest name from URL
            const urlParams = new URLSearchParams(window.location.search);
            const guest = urlParams.get('to') || 'Tamu Undangan';
            guestNameEl.textContent = escapeHTML(guest);

            // 2. Handle opening the invitation
            openButton.addEventListener('click', () => {
                cover.classList.add('cover-open');
                mainContent.style.opacity = '1';
                // The body scroll is handled by the main container now
                document.querySelector('.relative.max-w-md').style.overflowY = 'auto';


                // Trigger ornament animation
                heroSection.classList.add('ornaments-visible');

                // Play music, handle browser autoplay policy
                music.play().catch(error => {
                    console.log("Autoplay was prevented. User needs to interact with the page for music to start.");
                });
                musicToggle.querySelector('i').classList.add('spin-slow');

                // Remove cover from DOM after animation for performance
                setTimeout(() => {
                    cover.style.display = 'none';
                }, 1300);
            });

            // 3. Countdown Timer
            const countdownDate = new Date("Nov 18, 2025 08:00:00").getTime();
            const countdownFunction = setInterval(() => {
                const now = new Date().getTime();
                const distance = countdownDate - now;

                if (distance < 0) {
                    clearInterval(countdownFunction);
                    document.getElementById('countdown').innerHTML = "<p class='text-xl'>Acara Telah Berakhir</p>";
                    return;
                }

                document.getElementById('days').innerText = Math.floor(distance / (1000 * 60 * 60 * 24)).toString().padStart(2, '0');
                document.getElementById('hours').innerText = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toString().padStart(2, '0');
                document.getElementById('minutes').innerText = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2, '0');
                document.getElementById('seconds').innerText = Math.floor((distance % (1000 * 60)) / 1000).toString().padStart(2, '0');
            }, 1000);

            // 4. Music Toggle
            musicToggle.addEventListener('click', () => {
                if (music.paused) {
                    music.play();
                    musicToggle.querySelector('i').classList.add('spin-slow');
                } else {
                    music.pause();
                    musicToggle.querySelector('i').classList.remove('spin-slow');
                }
            });
        });

        // 5. Copy to Clipboard function
        function copyToClipboard(elementSelector, message) {
            const textToCopy = document.querySelector(elementSelector).innerText;
            const textArea = document.createElement("textarea");
            
            textArea.value = textToCopy;
            
            // Prevent scrolling to bottom of page in MS Edge.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small size and is transparent
            textArea.style.width = '1px';
            textArea.style.height = '1px';
            textArea.style.padding = 0;
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            textArea.style.background = 'transparent';

            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                showCopyFeedback(message);
            } catch (err) {
                console.error('Gagal menyalin teks: ', err);
            }

            document.body.removeChild(textArea);
        }

        function showCopyFeedback(message) {
            const feedbackEl = document.getElementById('copy-feedback');
            if(feedbackEl) {
                feedbackEl.innerText = message;
                feedbackEl.style.opacity = '1';
                setTimeout(() => {
                    feedbackEl.style.opacity = '0';
                }, 2000);
            }
        }
    </script>
</body>
</html>
